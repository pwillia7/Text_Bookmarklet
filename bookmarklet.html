data:text/html,<html>
<head>
    <title>Notes</title>
    <style>
%3Aroot%20%7B%0A%20%20%20%20--primary-color%3A%20%235c6bc0%3B%0A%20%20%20%20--hover-color%3A%20%233949ab%3B%0A%20%20%20%20--background-color%3A%20%23f4f4f4%3B%0A%20%20%20%20--text-color%3A%20%23333%3B%0A%20%20%20%20--border-color%3A%20%23e0e0e0%3B%0A%20%20%20%20--border-hover-color%3A%20%23c0c0c0%3B%0A%20%20%20%20--input-border-color%3A%20%23ddd%3B%0A%20%20%20%20--pane-shadow%3A%20rgba(0%2C0%2C0%2C0.05)%3B%0A%20%20%20%20--active-border-color%3A%20%235c6bc0%3B%20%0A%20%20%20%20--pane-title-background%3A%20%23e8eaf6%3B%20%0A%7D%0A%0A*%20%7B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20padding%3A%200%3B%0A%20%20%20%20box-sizing%3A%20border-box%3B%0A%7D%0A%0Abody%20%7B%0A%20%20%20%20font-family%3A%20%27Open%20Sans%27%2C%20sans-serif%3B%0A%20%20%20%20font-size%3A%2016px%3B%20%0A%20%20%20%20line-height%3A%201.6%3B%20%0A%20%20%20%20background-color%3A%20var(--background-color)%3B%0A%20%20%20%20color%3A%20var(--text-color)%3B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20flex-direction%3A%20column%3B%0A%20%20%20%20height%3A%20100vh%3B%0A%20%20%20%20overflow%3A%20hidden%3B%0A%7D%0A%0A.top-pane%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20justify-content%3A%20space-between%3B%0A%20%20%20%20align-items%3A%20center%3B%0A%20%20%20%20padding%3A%2015px%3B%0A%20%20%20%20background%3A%20var(--background-color)%3B%0A%20%20%20%20box-shadow%3A%200%202px%204px%200%20rgba(0%2C0%2C0%2C0.05)%3B%0A%7D%0A%0A.pane-title%2C%20.button-bar%20button%2C%20%23entry-title%20%7B%0A%20%20%20%20font-weight%3A%20600%3B%0A%7D%0A%0A%23entry-title%20%7B%0A%20%20%20%20flex-grow%3A%201%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20font-size%3A%201.2rem%3B%0A%20%20%20%20border%3A%201px%20solid%20var(--input-border-color)%3B%0A%20%20%20%20border-radius%3A%205px%3B%20%0A%20%20%20%20margin-right%3A%2010px%3B%0A%7D%0A%0A.button-bar%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%7D%0A%0A.button-container%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20align-items%3A%20center%3B%0A%7D%0A%0A.move-btn%2C%20.delete-btn%2C%20.color-btn%20%7B%0A%20%20%20%20background%3A%20none%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%20%20%20%20padding%3A%205px%3B%0A%20%20%20%20font-size%3A%201rem%3B%0A%20%20%20%20color%3A%20%23333%3B%0A%7D%0A%0A.modal%20%7B%0A%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20top%3A%200%3B%0A%20%20%20%20left%3A%200%3B%0A%20%20%20%20width%3A%20100%25%3B%0A%20%20%20%20height%3A%20100%25%3B%0A%20%20%20%20background-color%3A%20rgba(0%2C%200%2C%200%2C%200.5)%3B%0A%20%20%20%20z-index%3A%202000%3B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20justify-content%3A%20center%3B%0A%20%20%20%20align-items%3A%20center%3B%0A%7D%0A%0A.modal-content%20%7B%0A%20%20%20%20background%3A%20white%3B%0A%20%20%20%20padding%3A%2020px%3B%0A%20%20%20%20border-radius%3A%205px%3B%0A%20%20%20%20box-shadow%3A%200%204px%208px%20rgba(0%2C%200%2C%200%2C%200.1)%3B%0A%20%20%20%20text-align%3A%20center%3B%0A%20%20%20%20max-width%3A%2090%25%3B%0A%20%20%20%20width%3A%20400px%3B%0A%7D%0A%0A.modal-content%20input%5Btype%3D%22text%22%5D%20%7B%0A%20%20%20%20width%3A%2080%25%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20margin-bottom%3A%2020px%3B%0A%20%20%20%20border%3A%201px%20solid%20var(--input-border-color)%3B%0A%20%20%20%20border-radius%3A%204px%3B%0A%7D%0A%0A.modal-content%20button%20%7B%0A%20%20%20%20padding%3A%2010px%2020px%3B%0A%20%20%20%20margin%3A%200%2010px%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20border-radius%3A%204px%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%20%20%20%20background-color%3A%20var(--primary-color)%3B%0A%20%20%20%20color%3A%20white%3B%0A%20%20%20%20transition%3A%20background-color%200.3s%20ease%3B%0A%7D%0A%0A.modal-content%20button%3Ahover%20%7B%0A%20%20%20%20background-color%3A%20var(--hover-color)%3B%0A%7D%0A%0A.color-picker%20input%5Btype%3D%22color%22%5D%20%7B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20width%3A%2048px%3B%0A%20%20%20%20height%3A%2048px%3B%0A%20%20%20%20-webkit-appearance%3A%20none%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20padding%3A%200%3B%0A%7D%0A%0A.color-picker%20input%5Btype%3D%22color%22%5D%3A%3A-webkit-color-swatch-wrapper%20%7B%0A%20%20%20%20padding%3A%200%3B%0A%7D%0A%0A.color-picker%20input%5Btype%3D%22color%22%5D%3A%3A-webkit-color-swatch%20%7B%0A%20%20%20%20border%3A%20none%3B%0A%7D%0A%0A.entry-item.dragging%2C%20%0A.entry-pane.dragging%20%7B%0A%20%20%20%20opacity%3A%200.5%3B%0A%7D%0A%0A.entry-item.drag-over%2C%20%0A.entry-pane.drag-over%20%7B%0A%20%20%20%20border%3A%202px%20dashed%20var(--primary-color)%3B%0A%20%20%20%20background-color%3A%20var(--hover-color)%3B%0A%7D%0A%0A.entry-item.dynamic-text-color%20%7B%0A%20%20%20%20color%3A%20var(--dynamic-text-color)%3B%0A%7D%0A%0A.color-picker-icon%20%7B%0A%20%20%20%20width%3A%2024px%3B%20%0A%20%20%20%20height%3A%2024px%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%7D%0A%0A.rename-input%20%7B%0A%20%20%20%20font-size%3A%201rem%3B%0A%20%20%20%20padding%3A%200.5rem%3B%0A%20%20%20%20margin-bottom%3A%200.5rem%3B%0A%7D%0A%0A.save-rename-btn%2C%20.cancel-rename-btn%20%7B%0A%20%20%20%20font-size%3A%201rem%3B%0A%20%20%20%20padding%3A%200.5rem%201rem%3B%0A%20%20%20%20margin-right%3A%200.5rem%3B%0A%7D%0A%0A.cancel-rename-btn%20%7B%0A%20%20%20%20background-color%3A%20%23ccc%3B%0A%20%20%20%20color%3A%20var(--text-color)%3B%0A%7D%0A%0A.cancel-rename-btn%3Ahover%20%7B%0A%20%20%20%20background-color%3A%20%23bbb%3B%0A%7D%0A%0Ainput%5Btype%3D%27checkbox%27%5D%20%7B%0A%20%20%20%20-webkit-appearance%3A%20none%3B%0A%20%20%20%20-moz-appearance%3A%20none%3B%0A%20%20%20%20appearance%3A%20none%3B%0A%20%20%20%20background-color%3A%20var(--background-color)%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20font%3A%20inherit%3B%0A%20%20%20%20color%3A%20var(--text-color)%3B%0A%20%20%20%20width%3A%201em%3B%0A%20%20%20%20height%3A%201em%3B%0A%20%20%20%20border%3A%201px%20solid%20var(--border-color)%3B%0A%20%20%20%20border-radius%3A%203px%3B%0A%20%20%20%20transform%3A%20translateY(-0.075em)%3B%0A%20%20%20%20display%3A%20inline-grid%3B%0A%20%20%20%20place-content%3A%20center%3B%0A%20%20%20%20margin-left%3A%200.5em%3B%0A%20%20%20%20margin-right%3A%200.5em%3B%0A%20%20%20%20padding-left%3A%200.5em%3B%0A%20%20%20%20padding-right%3A%200.5em%3B%0A%7D%0A%0Ainput%5Btype%3D%27checkbox%27%5D%3Achecked%3A%3Abefore%20%7B%0A%20%20%20%20content%3A%20%27%27%3B%0A%20%20%20%20width%3A%200.65em%3B%0A%20%20%20%20height%3A%200.65em%3B%0A%20%20%20%20clip-path%3A%20polygon(14%25%2044%25%2C%200%25%2070%25%2C%2050%25%20100%25%2C%20100%25%2028%25%2C%2085%25%2014%25%2C%2050%25%2068%25)%3B%0A%20%20%20%20background-color%3A%20var(--primary-color)%3B%0A%20%20%20%20display%3A%20block%3B%0A%7D%0A%0Ainput%5Btype%3D%27checkbox%27%5D%3Ahover%20%7B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%20%20%20%20border-color%3A%20var(--hover-color)%3B%0A%7D%0A%0Ainput%5Btype%3D%27checkbox%27%5D%3Afocus%20%7B%0A%20%20%20%20outline%3A%20none%3B%0A%20%20%20%20box-shadow%3A%200%200%200%202px%20var(--active-border-color)%3B%0A%7D%0A%0A.color-picker%20%7B%0A%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20top%3A%2050%25%3B%0A%20%20%20%20left%3A%2050%25%3B%0A%20%20%20%20transform%3A%20translate(-50%25%2C%20-50%25)%3B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20flex-wrap%3A%20wrap%3B%0A%20%20%20%20background-color%3A%20%23fff%3B%0A%20%20%20%20border%3A%201px%20solid%20var(--input-border-color)%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20z-index%3A%201000%3B%0A%20%20%20%20border-radius%3A%205px%3B%0A%7D%0A%0A.color-option%20%7B%0A%20%20%20%20width%3A%2030px%3B%0A%20%20%20%20height%3A%2030px%3B%0A%20%20%20%20margin%3A%205px%3B%0A%20%20%20%20border-radius%3A%2050%25%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%7D%0A%0A.button-bar%20button%20%7B%0A%20%20%20%20padding%3A%2010px%2015px%3B%0A%20%20%20%20font-size%3A%201rem%3B%0A%20%20%20%20margin-left%3A%2010px%3B%0A%20%20%20%20background-color%3A%20var(--primary-color)%3B%0A%20%20%20%20color%3A%20white%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20border-radius%3A%205px%3B%20%0A%20%20%20%20transition%3A%20background-color%200.3s%20ease%3B%0A%7D%0A%0A.button-bar%20button%3Afocus%20%7B%0A%20%20%20%20outline%3A%20none%3B%0A%20%20%20%20box-shadow%3A%200%200%200%202px%20var(--hover-color)%3B%0A%7D%0A%0A.button-bar%20button%3Ahover%20%7B%0A%20%20%20%20background-color%3A%20var(--hover-color)%3B%0A%7D%0A%0A.button-bar%20button%2C%20.entry-item%20%7B%0A%20%20%20%20padding%3A%2012px%2018px%3B%0A%7D%0A%0A.button-bar%20button%2C%20.color-option%20%7B%0A%20%20%20%20border-radius%3A%208px%3B%0A%7D%0A%0A.content-area%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20height%3A%20calc(100%25%20-%2060px)%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20padding-left%3A%200%3B%0A%20%20%20%20overflow%3A%20hidden%3B%0A%7D%0A%0A%23entry-list%20%7B%0A%20%20%20%20flex%3A%20none%3B%0A%20%20%20%20width%3A%2020%25%3B%0A%20%20%20%20max-width%3A%20250px%3B%0A%20%20%20%20overflow-y%3A%20auto%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20border-right%3A%201px%20solid%20var(--border-color)%3B%0A%7D%0A%0A%23entry-list%2C%20.entry-pane%20%7B%0A%20%20%20%20border%3A%201px%20solid%20var(--border-color)%3B%0A%7D%0A%0A.entry-item%3Ahover%2C%20.button-bar%20button%3Ahover%20%7B%0A%20%20%20%20transition%3A%20box-shadow%200.3s%20ease%2C%20background-color%200.3s%20ease%3B%0A%7D%0A%0A%23entry-content%20%7B%0A%20%20%20%20flex-grow%3A%201%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20height%3A%20100%25%3B%0A%20%20%20%20overflow-y%3A%20auto%3B%0A%7D%0A%0A.top-pane%2C%20.entry-pane%2C%20.color-picker%20%7B%0A%20%20%20%20box-shadow%3A%200%201px%203px%200%20rgba(0%2C0%2C0%2C0.05)%3B%0A%7D%0A%0A.entry-item%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20justify-content%3A%20space-between%3B%0A%20%20%20%20align-items%3A%20center%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20margin-bottom%3A%2010px%3B%0A%20%20%20%20border%3A%201px%20solid%20var(--border-color)%3B%0A%20%20%20%20border-radius%3A%208px%3B%20%0A%20%20%20%20transition%3A%20box-shadow%200.3s%20ease%2C%20border-color%200.3s%20ease%3B%0A%7D%0A%0A.entry-item%3Ahover%20%7B%0A%20%20%20%20box-shadow%3A%200%202px%204px%200%20rgba(0%2C0%2C0%2C0.1)%3B%0A%20%20%20%20border-color%3A%20var(--border-hover-color)%3B%0A%7D%0A%0A.entry-item.active%20%7B%0A%20%20%20%20border%3A%202px%20solid%20var(--active-border-color)%3B%0A%20%20%20%20font-weight%3A%20bold%3B%20%0A%7D%0A%0A%23entry-content-storage%20%7B%0A%20%20%20%20display%3A%20none%3B%0A%7D%0A%0A.split-vertical%2C%20.split-horizontal%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20height%3A%20100%25%3B%0A%7D%0A%0A.split-horizontal%20%7B%0A%20%20%20%20flex-direction%3A%20row%3B%0A%7D%0A%0A.split-vertical%20%3E%20.entry-pane%2C%0A.split-horizontal%20%3E%20.entry-pane%20%7B%0A%20%20%20%20flex%3A%201%3B%0A%20%20%20%20margin%3A%205px%3B%0A%20%20%20%20border-radius%3A%205px%3B%0A%7D%0A%0A.pane-title%20%7B%0A%20%20%20%20background-color%3A%20var(--pane-title-background)%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20border-bottom%3A%201px%20solid%20%23ddd%3B%0A%20%20%20%20font-weight%3A%20bold%3B%0A%20%20%20%20border-top-left-radius%3A%205px%3B%0A%20%20%20%20border-top-right-radius%3A%205px%3B%0A%7D%0A%0A.entry-pane%20%7B%0A%20%20%20%20background-color%3A%20%23fff%3B%0A%20%20%20%20border%3A%201px%20solid%20%23ddd%3B%0A%20%20%20%20box-shadow%3A%200%202px%204px%200%20var(--pane-shadow)%3B%0A%20%20%20%20position%3A%20relative%3B%0A%20%20%20%20overflow%3A%20hidden%3B%0A%20%20%20%20border-radius%3A%205px%3B%0A%7D%0A%0A.bg-color-picker-icon%20%7B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20bottom%3A%2010px%3B%0A%20%20%20%20right%3A%2010px%3B%0A%7D%0A%0A.entry-pane%20%3E%20div%5Bcontenteditable%3D%22true%22%5D%20%7B%0A%20%20%20%20padding%3A%2015px%3B%0A%20%20%20%20font-size%3A%201rem%3B%0A%20%20%20%20height%3A%20calc(100%25%20-%2050px)%3B%0A%20%20%20%20overflow-y%3A%20auto%3B%0A%7D%0A%0A%3A%3A-webkit-scrollbar%20%7B%0A%20%20%20%20width%3A%2010px%3B%0A%7D%0A%0A%3A%3A-webkit-scrollbar-thumb%20%7B%0A%20%20%20%20background%3A%20var(--border-hover-color)%3B%0A%20%20%20%20border-radius%3A%2010px%3B%0A%7D%0A%0A%40media%20screen%20and%20(max-width%3A%20720px)%20%7B%0A%20%20%20%20.content-area%20%7B%0A%20%20%20%20%20%20%20%20flex-direction%3A%20column%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%23entry-list%2C%20%23entry-content%20%7B%0A%20%20%20%20%20%20%20%20width%3A%20100%25%3B%0A%20%20%20%20%20%20%20%20height%3A%20auto%3B%0A%20%20%20%20%20%20%20%20border-right%3A%20none%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20.button-bar%20button%20%7B%0A%20%20%20%20%20%20%20%20padding%3A%2012px%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20.entry-pane%20%7B%0A%20%20%20%20%20%20%20%20margin%3A%205px%200%3B%0A%20%20%20%20%7D%0A%7D%0A    </style>
</head>
<body>
    <div class="top-pane">
        <input id="entry-title" type="text" placeholder="Create new entry here...">
        <div class="button-bar">
            <button id="save-button" type="button">Save as txt file</button>
            <button id="save-db-button" type="button">Save Database</button>
            <button id="load-db-button" type="button">Load Database</button>
        </div>
    </div>
    <div class="content-area">
        <div id="entry-list"></div>
        <div id="entry-content"></div>
    </div>
    <textarea id="entry-content-storage" style="display:none;"></textarea>
    <input id="file-input" type="file" style="display: none;">
    <script type="text/javascript">
        function changeFavicon(url) {
            var link = document.createElement('link'),
                oldLink = document.querySelector('link[rel="shortcut icon"]') || document.querySelector('link[rel="icon"]');
            link.rel = 'shortcut icon';
            link.href = url;

            if (oldLink) {
                document.head.removeChild(oldLink);
            }
            document.head.appendChild(link);
        }

        function createToggleButton(text, orientation) {
            var button = document.createElement('button');
            button.textContent = text;
            button.style.cursor = 'pointer';
            button.style.padding = '1px';

            button.style.border = '1px solid %23ccc';
            button.style.backgroundColor = '%23f9f9f9';

            if (orientation === 'horizontal') {
                button.style.width = '100%';
                button.style.marginTop = '-14px';
                button.style.zIndex = '99999';
                button.style.marginBottom = '-20px';
                button.style.height = '0.9em';
            } else {
                button.style.height = '100%';
                button.style.display = 'block';
                button.style.zIndex = '99998';
                button.style.marginRight = '-10px';
            }

            return button;
        }

        function savePaneContent() {
            var allPanes = entryContent.querySelectorAll('.entry-pane');
            allPanes.forEach(pane => {
                var entryId = pane.dataset.entryId;
                var contentDiv = pane.querySelector('div[contenteditable="true"]');
                if (contentDiv && entryId !== undefined) {
                    var entryIndex = entries.findIndex(entry => entry.id.toString() === entryId);
                    if (entryIndex !== -1) {
                        var clone = contentDiv.cloneNode(true);
                        clone.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                            var textNode = document.createTextNode(checkbox.checked ? '[x] ' : '[ ] ');
                            checkbox.parentNode.replaceChild(textNode, checkbox);
                        });
                        entries[entryIndex].content = clone.innerHTML;
                    }
                }
            });
            saveEntries();
        }

        function saveEntries() {
            entryContentStorage.value = JSON.stringify(entries);
        }

        function loadEntries() {
            var storedEntries = entryContentStorage.value;
            if (!storedEntries) {
                entries = []; 
                var defaultEntry = addNewEntry("Notes"); 
                current = defaultEntry.id;
                updateEntryList();
                clearAndLoadEntry(defaultEntry);
                return;
            }
            try {
                entries = JSON.parse(storedEntries);
                entries.forEach(entry => {
                    var entryElement = document.querySelector(`[data-index='${entry.id}']`);
                    if (entryElement) {
                        if (entry.titleBarColor) {
                            var titleBar = entryElement.querySelector('.pane-title');
                            if (titleBar) {
                                titleBar.style.backgroundColor = entry.titleBarColor;
                                titleBar.style.color = isColorLight(entry.titleBarColor) ? 'black' : 'white';
                            }
                        }
                        if (entry.contentBackgroundColor) {
                            var contentDiv = entryContent.querySelector(`[data-entry-id='${entry.id}'] .content-editable`);
                            if (contentDiv) {
                                contentDiv.style.backgroundColor = entry.contentBackgroundColor;
                                contentDiv.style.color = isColorLight(entry.contentBackgroundColor) ? 'black' : 'white';
                            }
                        }
                    }
                });
                updateEntryList();
                if (entries.length > 0) {
                    current = 0;
                    clearAndLoadEntry(entries[current]);
                }
            } catch (e) {
                console.error('Error parsing entries:', e);
            }
        }
        

        function ensureDivWrapper(contentEditableDiv) {
            var htmlContent = contentEditableDiv.innerHTML.trim();
            if (htmlContent === "" || htmlContent === "<br>") {
                contentEditableDiv.innerHTML = "<div><br></div>";
            }
        }
        
        function addNewEntry(title) {
            var defaultBackgroundColor = '%23ffffff';
            var newEntry = {
                id: entries.length,
                title: title,
                content: "",
                titleBarColor: defaultBackgroundColor,
                contentBackgroundColor: defaultBackgroundColor
            };
            entries.push(newEntry);
            saveEntries();
            return newEntry;
        }
        

        function reorderEntries(sourceIndex, targetIndex) {
            if (sourceIndex === targetIndex) return;
            const movedItem = entries.splice(sourceIndex, 1)[0];
            entries.splice(targetIndex, 0, movedItem);
            updateEntryList();
            saveEntries();

            document.querySelectorAll('.entry-item').forEach((item, index) => {
                const entry = entries[index];
                if (entry.titleBarColor) {
                    item.style.backgroundColor = entry.titleBarColor;
                    item.style.color = isColorLight(entry.titleBarColor) ? 'black' : 'white';
                }
            });
        }

        function addDragAndDropVisuals() {
            document.querySelectorAll('.entry-item').forEach(item => {
                item.ondragstart = function() {
                    item.classList.add('dragging');
                };
                item.ondragend = function() {
                    item.classList.remove('dragging');
                };
                item.ondragover = function() {
                    item.classList.add('drag-over');
                };
                item.ondragleave = function() {
                    item.classList.remove('drag-over');
                };
            });
        }

        function updateEntryList() {
            var entryListContainer = document.createElement("div");
            entries.forEach(function(entry, index) {
                var e = document.createElement("div");
                e.className = "entry-item";
                e.setAttribute('data-index', index.toString());
                e.draggable = true;
        
                if (entry.titleBarColor && entry.titleBarColor !== 'default') {
                    updateEntryColor(e, entry.titleBarColor, false);
                }
        
                e.ondragstart = function(event) {
                    event.dataTransfer.setData("text/index", index.toString());
                };
        
                e.ondragover = function(event) {
                    event.preventDefault();
                };
        
                e.ondrop = function(event) {
                    event.preventDefault();
                    var sourceIndex = event.dataTransfer.getData("text/index");
                    var targetIndex = index;
                    reorderEntries(parseInt(sourceIndex), parseInt(targetIndex));
                };
        
                var textSpan = document.createElement("span");
                textSpan.textContent = entry.title;
                e.ondblclick = function(event) {
                    event.stopPropagation();
                    showRenameModal(entry, updateEntryList);
                };
                e.appendChild(textSpan);
        
                var deleteBtn = document.createElement("button");
                deleteBtn.textContent = "X";
                deleteBtn.className = "delete-btn";
                deleteBtn.onclick = function(event) {
                    event.stopPropagation();
                    showModal("Are you sure you want to delete this note?", function() {
                        entries.splice(index, 1);
                        if (current === index) {
                            current = -1;
                            entryContent.classList.remove('active');
                        }
                        updateEntryList();
                        addDragAndDropVisuals();
                        updateEntryContent();
                        saveEntries();
                    });
                };
        
                var colorBtn = createColorPickerIcon();
                colorBtn.classList.add("color-btn");
                colorBtn.onclick = function(event) {
                    event.stopPropagation();
                    showColorPicker(e, entry, false);
                };
        
                var buttonContainer = document.createElement("div");
                buttonContainer.className = "button-container";
                buttonContainer.appendChild(colorBtn);
                buttonContainer.appendChild(deleteBtn);
                e.appendChild(buttonContainer);
        
                if (index === current) {
                    e.classList.add("active");
                    entryContent.classList.add('active');
                }
        
                if (entry.color && entry.color !== 'none') {
                    updateEntryColor(e, entry.color, true);
                }
        
                e.onclick = function() {
                    current = index;
                    clearAndLoadEntry(entries[index]);
                    updateEntryContent();
                    updateEntryList();
                };
        
                entryListContainer.appendChild(e);
            });
            entryList.innerHTML = '';
            entryList.appendChild(entryListContainer);
        }
        
        function isColorLight(color) {
            if (color.startsWith('%23')) {
                color = color.substring(1);
            }
            var r = parseInt(color.substr(0, 2), 16);
            var g = parseInt(color.substr(2, 2), 16);
            var b = parseInt(color.substr(4, 2), 16);
            var yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return yiq >= 128;
        }

        function updateEntryColor(entryElement, color, isBackgroundColor) {
            entryElement.style.backgroundColor = color;
            var textColor = isColorLight(color) ? 'black' : 'white';
            entryElement.style.color = textColor;
            var entryIndex = parseInt(entryElement.dataset.index);
            var entry = entries[entryIndex];
            if (entry) {
                if (isBackgroundColor) {
                    entry.contentBackgroundColor = color;
                    entryElement.style.backgroundColor = color;
                    entryElement.style.color = isColorLight(color) ? 'black' : 'white';
                } else {
                    entry.titleBarColor = color;
                    if (entryElement.querySelector('.pane-title')) {
                        var titleBar = entryElement.querySelector('.pane-title');
                        titleBar.style.backgroundColor = color;
                        titleBar.style.color = isColorLight(color) ? 'black' : 'white';
                    }
                }
                saveEntries();
                clearAndLoadEntry(entry);
            }
            if (!isBackgroundColor) {
                var pane = entryContent.querySelector(`[data-entry-id='${entryIndex}']`);
                if (pane) {
                    var titleBar = pane.querySelector('.pane-title');
                    if (titleBar) {
                        titleBar.style.backgroundColor = color;
                        titleBar.style.color = textColor;
                    }
                }
            }
        }

        function showColorPicker(entryElement, entry, isBackgroundColor) {
            var colorPicker = document.createElement("input");
            colorPicker.type = "color";
            colorPicker.value = "%23ffffff";
            colorPicker.style.display = 'block';
            colorPicker.style.position = 'absolute';
            colorPicker.style.left = '50%';
            colorPicker.style.top = '50%';
            colorPicker.oninput = function() {
                var selectedColor = colorPicker.value;
                if (isBackgroundColor) {
                    entry.contentBackgroundColor = selectedColor;
                    entryElement.style.backgroundColor = selectedColor;
                } else {
                    entry.titleBarColor = selectedColor;
                    entryElement.style.backgroundColor = selectedColor;
                    if (entryElement.querySelector('.pane-title')) {
                        entryElement.querySelector('.pane-title').style.backgroundColor = selectedColor;
                    }
                }
                saveEntries();
                clearAndLoadEntry(entry);
            };
            document.body.appendChild(colorPicker);
            colorPicker.click();
        
            function removeColorPicker() {
                if (document.body.contains(colorPicker)) {
                    document.body.removeChild(colorPicker);
                }
                document.removeEventListener('click', removeColorPicker);
            }
        
            setTimeout(() => {
                document.addEventListener('click', removeColorPicker);
            }, 0);
        
            colorPicker.onchange = function() {
                removeColorPicker();
            };
        }
        

        function reorderPanes(sourcePaneId, targetPaneId) {
            if (sourcePaneId === targetPaneId) return;
            var sourcePane = entryContent.querySelector(`[data-entry-id='${sourcePaneId}']`);
            var targetPane = entryContent.querySelector(`[data-entry-id='${targetPaneId}']`);
            if (sourcePane && targetPane) {
                var isSourceBeforeTarget = sourcePane.compareDocumentPosition(targetPane) & Node.DOCUMENT_POSITION_FOLLOWING;
                if (isSourceBeforeTarget) {
                    targetPane.parentNode.insertBefore(sourcePane, targetPane.nextSibling);
                } else {
                    targetPane.parentNode.insertBefore(sourcePane, targetPane);
                }
                adjustPaneSizes();
            }
        }

        function adjustPaneSizes() {
            var splitContainers = entryContent.querySelectorAll('.split-horizontal, .split-vertical');
            splitContainers.forEach(container => {
                var panes = Array.from(container.children);
                var flexBasis = 100 / panes.length + '%';
                panes.forEach(pane => {
                    pane.style.flexBasis = flexBasis;
                    pane.style.flexGrow = 1;
                });
            });
        }

        function updateEntryContent() {
            if (current >= 0) {
                entryContent.innerHTML = entries[current].content;
                entryContent.classList.add('active');
            } else {
                entryContent.innerHTML = "";
                entryContent.classList.remove('active');
            }
        }

        function showRenameModal(entry, updateEntryList) {
            var modal = document.createElement("div");
            modal.className = "rename-modal";
            var modalContent = document.createElement("div");
            modalContent.className = "modal-content";
            var inputField = document.createElement("input");
            inputField.type = "text";
            inputField.value = entry.title;
            inputField.className = "rename-input";
            var saveButton = document.createElement("button");
            saveButton.textContent = "Save";
            saveButton.className = "save-rename-btn";
            saveButton.onclick = function() {
                var newName = inputField.value.trim();
                if (newName && newName !== entry.title) {
                    entry.title = newName;
                    updateEntryList();
                    saveEntries();
                }
                modal.remove();
            };
            var cancelButton = document.createElement("button");
            cancelButton.textContent = "Cancel";
            cancelButton.className = "cancel-rename-btn";
            cancelButton.onclick = function() {
                modal.remove();
            };
            modalContent.appendChild(inputField);
            modalContent.appendChild(saveButton);
            modalContent.appendChild(cancelButton);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            inputField.focus();
            inputField.select();
        }

        function showModal(message, onConfirm) {
            var modal = document.createElement("div");
            modal.className = "modal";
            var modalContent = document.createElement("div");
            modalContent.className = "modal-content";
            var modalText = document.createElement("p");
            modalText.textContent = message;
            var confirmButton = document.createElement("button");
            confirmButton.textContent = "Confirm";
            confirmButton.onclick = function() {
                onConfirm();
                modal.remove();
            };
            var cancelButton = document.createElement("button");
            cancelButton.textContent = "Cancel";
            cancelButton.onclick = function() {
                modal.remove();
            };
            modalContent.appendChild(modalText);
            modalContent.appendChild(confirmButton);
            modalContent.appendChild(cancelButton);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

        function createPane(entry, entryIndex) {
            var pane = document.createElement('div');
            pane.className = 'entry-pane';
            pane.dataset.entryId = entryIndex.toString();
            var titleBar = document.createElement('div');
            titleBar.className = 'pane-title';
            titleBar.textContent = entry.title;
            titleBar.draggable = true;
            titleBar.ondragstart = function(event) {
                event.dataTransfer.setData("pane-id", entryIndex.toString());
            };
            var defaultColor = '%23ffffff';
            var titleBarColor = entry.titleBarColor ? entry.titleBarColor : defaultColor;
            titleBar.style.backgroundColor = titleBarColor;
            titleBar.style.color = isColorLight(titleBarColor) ? 'black' : 'white';
            pane.appendChild(titleBar);
            var contentDiv = document.createElement('div');
            contentDiv.contentEditable = true;
            contentDiv.className = 'content-editable';
            var contentBackgroundColor = entry.contentBackgroundColor ? entry.contentBackgroundColor : defaultColor;
            contentDiv.style.backgroundColor = contentBackgroundColor;
            contentDiv.style.color = isColorLight(contentBackgroundColor) ? 'black' : 'white';
            contentDiv.innerHTML = entry.content;
            pane.appendChild(contentDiv);
            var bgColorPickerIcon = createColorPickerIcon();
            bgColorPickerIcon.classList.add('bg-color-picker-icon');
            bgColorPickerIcon.style.position = 'absolute';
            bgColorPickerIcon.style.bottom = '10px';
            bgColorPickerIcon.style.right = '10px';
            bgColorPickerIcon.onclick = function(event) {
                event.stopPropagation();
                showColorPicker(pane, entry, true);
            };
            pane.appendChild(bgColorPickerIcon);
            return pane;
        }

        function createColorPickerIcon() {
            var icon = document.createElement('img');
            icon.setAttribute('src', "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-edit-3'><path d='M12 20h9'></path><path d='M16.5 3.5a2.121 2.121 0 0 1 3 3L10 16H7v-3L16.5 3.5z'></path></svg>");
            icon.className = 'color-picker-icon';
            return icon;
        }

        function clearAndLoadEntry(entry) {
            entryContent.innerHTML = '';
            var pane = createPane(entry, entry.id);
            entryContent.appendChild(pane);
        
            var contentDiv = pane.querySelector('.content-editable');
            if (entry.contentBackgroundColor) {
                contentDiv.style.backgroundColor = entry.contentBackgroundColor;
                contentDiv.style.color = isColorLight(entry.contentBackgroundColor) ? 'black' : 'white';
            }
        
            contentDiv.innerHTML = entry.content.replace(/\[ \]/g, '<input type="checkbox">').replace(/\[x\]/g, '<input type="checkbox" checked>');
            ensureDivWrapper(contentDiv);
            updateTitleBarAndSidebar(entry, pane);
        }
        

        function splitPane(container, entryToSplit) {
            var entryIndex = entries.findIndex(entry => entry === entryToSplit);
            if (entryIndex === -1) return;
        
            var newPane = createPane(entryToSplit, entryIndex);
            if (container.children.length === 0) {
                container.appendChild(newPane);
            } else {
                var existingSplitContainer = container.querySelector('.split-horizontal');
                if (existingSplitContainer) {
                    existingSplitContainer.appendChild(newPane);
                } else {
                    var splitContainer = document.createElement('div');
                    splitContainer.className = 'split-horizontal';
                    splitContainer.appendChild(container.firstChild.cloneNode(true));
                    splitContainer.appendChild(newPane);
        
                    container.innerHTML = '';
                    container.appendChild(splitContainer);
                }
            }
            adjustPaneSizes();
        }
        
              
        function toggleTopPane() {
            var topPane = document.querySelector('.top-pane');
            var isHidden = topPane.style.display === 'none';
            topPane.style.display = isHidden ? 'flex' : 'none';
            toggleTopPaneButton.style.height = isHidden ? '0.9em' : '1.5em';
            toggleTopPaneButton.style.marginTop = isHidden ? '-14px' : '0px';
            toggleTopPaneButton.textContent = isHidden ? '^' : 'v';
        }

        function toggleSidebar() {
            var sidebar = document.getElementById('entry-list');
            var isHidden = sidebar.style.display === 'none';
            sidebar.style.display = isHidden ? 'block' : 'none';
            toggleSidebarButton.textContent = isHidden ? '<' : '>';
        }

        function moveCursorToEnd(element) {
            var range = document.createRange();
            var sel = window.getSelection();
            range.setStart(element, 1);
            range.collapse(true);
            sel.removeAllRanges();
            sel.addRange(range);
            element.focus();
        }

        function createCheckboxLine() {
            var newCheckbox = document.createElement('input');
            newCheckbox.type = 'checkbox';
            var newDiv = document.createElement('div');
            newDiv.appendChild(newCheckbox);
            newDiv.appendChild(document.createTextNode(' '));
            return newDiv;
        }

        function createTextCheckboxLine() {
            var newDiv = document.createElement('div');
            newDiv.textContent = '[ ] ';
            return newDiv;
        }

        function moveCheckboxLine(currentDiv, siblingDiv, direction) {
            var movedDiv;
            if (direction === "ArrowUp") {
                currentDiv.parentNode.insertBefore(currentDiv, siblingDiv);
                movedDiv = currentDiv;
            } else {
                var nextSibling = siblingDiv.nextElementSibling;
                currentDiv.parentNode.insertBefore(currentDiv, nextSibling);
                movedDiv = currentDiv;
            }
            return movedDiv;
        }

        function setCursorToEnd(div) {
            var range = document.createRange();
            var sel = window.getSelection();
            range.selectNodeContents(div);
            range.collapse(false);
            sel.removeAllRanges();
            sel.addRange(range);
        }

        function updateTitleBarAndSidebar(entry, pane) {
            var titleBar = pane.querySelector('.pane-title');
            if (entry.titleBarColor) {
                titleBar.style.backgroundColor = entry.titleBarColor;
                titleBar.style.color = isColorLight(entry.titleBarColor) ? 'black' : 'white';
            }
            var sidebarEntry = document.querySelector(`[data-index='${entry.id}']`);
            if (sidebarEntry) {
                if (entry.titleBarColor) {
                    sidebarEntry.style.backgroundColor = entry.titleBarColor;
                    sidebarEntry.style.color = isColorLight(entry.titleBarColor) ? 'black' : 'white';
                }
            }
        }

        function autoSaveEntries() {
            let currentEntries = JSON.stringify(entries);
            if (currentEntries !== lastSavedEntries) {
                saveEntries();
                lastSavedEntries = currentEntries;
            }
        }

        let lastSavedEntries = JSON.stringify(entries);

        setInterval(autoSaveEntries, 60000);

        var faviconUrl = 'https://reticulated.net/favicon/favicon.ico';
        changeFavicon(faviconUrl);

        var entryTitle = document.getElementById("entry-title"),
            entryList = document.getElementById("entry-list"),
            entryContent = document.getElementById("entry-content"),
            entryContentStorage = document.getElementById("entry-content-storage"),
            saveDbButton = document.getElementById("save-db-button"),
            loadDbButton = document.getElementById("load-db-button"),
            saveButton = document.getElementById("save-button"),
            fileInput = document.getElementById("file-input"),
            entries = [],
            current = -1;

        var toggleSidebarButton = createToggleButton('<', 'vertical');
        toggleSidebarButton.onclick = toggleSidebar;
        document.querySelector('.content-area').insertBefore(toggleSidebarButton, entryContent);

        var toggleTopPaneButton = createToggleButton('^', 'horizontal');
        toggleTopPaneButton.onclick = toggleTopPane;
        document.querySelector('.top-pane').parentNode.insertBefore(toggleTopPaneButton, document.querySelector('.content-area'));

        var questionMarkIcon = document.createElement('span');
        questionMarkIcon.textContent = '?';
        questionMarkIcon.style.position = 'absolute';
        questionMarkIcon.style.left = '10px';
        questionMarkIcon.style.bottom = '10px';
        questionMarkIcon.style.fontSize = '24px';
        questionMarkIcon.style.cursor = 'pointer';
        document.body.appendChild(questionMarkIcon);

        questionMarkIcon.onclick = function() {
            var overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.left = 0;
            overlay.style.top = 0;
            overlay.style.zIndex = '9999999';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            overlay.innerHTML = `
                <div style="color: white; padding: 20px; max-width: 600px; margin: 50px auto;">
                    <h2>Help & Tips</h2>
                    <ul>
                        <li><strong>Create and Manage Notes:</strong> Add new notes via the top input bar. Manage and view them in the sidebar.</li>
                        <li><strong>Split Note Pane:</strong> Split notes into multiple panes for comparison or multitasking.</li>
                        <li><strong>Reorder Notes:</strong> Drag and drop notes in the list to reorder them.</li>
                        <li><strong>Save and Load Notes:</strong> Save your notes to a hidden textarea and load them from this database.</li>
                        <li><strong>Checkbox Support:</strong> Add interactive checkboxes within notes by typing '[ ]' or '[x]'.</li>
                        <li><strong>Color Customization:</strong> Click the color icon in each note to set custom colors for titles and backgrounds.</li>
                        <li><strong>Reordering Split Panes:</strong> Rearrange the order of split note panes via drag-and-drop.</li>
                        <li><strong>Save as Text File:</strong> Export individual notes as text files using the 'Save as txt file' button.</li>
                        <li><strong>Copy/Paste HTML Support:</strong> Copy and paste HTML content directly into notes.</li>
                        <li><strong>Hide/Show Panes:</strong> Use the toggle buttons to hide or show the sidebar and top pane.</li>
                        <li>Read more at <a href='https://github.com/pwillia7/Text_Bookmarklet'>the project repository on Github.</a></li>
                    </ul>
                </div>
            `;
            document.body.appendChild(overlay);

            overlay.onclick = function() {
                document.body.removeChild(overlay);
            };
        };

        loadDbButton.addEventListener('click', function() {
            fileInput.click();
            fileInput.onchange = function(e) {
                var file = e.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(event) {
                        entryContentStorage.value = event.target.result;
                        loadEntries();
                        lastSavedEntries = JSON.stringify(entries);
                    };
                    reader.readAsText(file);
                }
            };
        });

        saveDbButton.addEventListener('click', function() {
            var content = entryContentStorage.value,
                blob = new Blob([content], {type: 'text/plain;charset=utf-8'}),
                a = document.createElement('a'),
                date = new Date(),
                dateString = date.toISOString().split('T')[0];

            var url = URL.createObjectURL(blob);
            a.href = url;
            a.download = 'notes_database_' + dateString + '.txt';
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        });

        fileInput.addEventListener('change', function() {
            var file = fileInput.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    entryContentStorage.value = e.target.result;
                    loadEntries();
                };
                reader.readAsText(file);
            }
        });

        entryTitle.addEventListener("keyup", function(t) {
            if (t.keyCode === 13) {
                var title = entryTitle.value.trim();
                if (title) {
                    var newEntry = addNewEntry(title);
                    current = newEntry.id;
                    updateEntryList();
                    clearAndLoadEntry(newEntry);
                    entryTitle.value = "";
                }
            }
        });
        

        saveButton.addEventListener('click', function() {
            if (current >= 0) {
                var content = entries[current].content;
                var tempDiv = document.createElement("div");
                tempDiv.innerHTML = content;
                tempDiv.querySelectorAll('div').forEach(div => {
                    if (div.querySelector('input[type="checkbox"]')) {
                        var checkboxText = div.querySelector('input[type="checkbox"]').checked ? '[x] ' : '[ ] ';
                        div.insertAdjacentText('afterbegin', checkboxText);
                    }
                    div.appendChild(document.createTextNode('\n'));
                });
                var plainText = tempDiv.textContent || tempDiv.innerText || "";
                plainText = plainText.replace(/&nbsp;/g, ' ');
                var title = entries[current].title || 'note';
                var blob = new Blob([plainText], {type: 'text/plain;charset=utf-8'});
                var a = document.createElement('a');
                var url = URL.createObjectURL(blob);
                a.href = url;
                a.download = title + '.txt';
                document.body.appendChild(a);
                a.click();
                URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }
        });

        entryContent.addEventListener('dragover', function(event) {
            event.preventDefault();
        });

        entryContent.ondrop = function(event) {
            event.preventDefault();
            var targetPane = event.target.closest('.entry-pane');
            if (!targetPane) return;
            var sourcePaneId = event.dataTransfer.getData("pane-id");
            var targetPaneId = targetPane.dataset.entryId;
            if (sourcePaneId && targetPaneId && sourcePaneId !== targetPaneId) {
                reorderPanes(sourcePaneId, targetPaneId);
            }
        };

        entryContent.ondragover = function(event) {
            event.preventDefault();
        };

        entryContent.addEventListener('input', function() {
            savePaneContent();
        });

        entryList.ondragover = function(event) {
            event.preventDefault();
        };

        entryList.addEventListener('click', function(event) {
            var target = event.target.closest('.entry-item');
            if (target) {
                var index = target.getAttribute('data-index');
                clearAndLoadEntry(entries[index]);
            }
        });

        entryList.ondrop = function(event) {
            event.preventDefault();
            var targetIndex = event.target.getAttribute('data-index');
            var sourceIndex = event.dataTransfer.getData("text/plain");
            if (sourceIndex !== null && targetIndex !== null) {
                reorderEntries(parseInt(sourceIndex), parseInt(targetIndex));
            }
        };

        document.getElementById('entry-content').addEventListener('click', function(event) {
            if (event.target.classList.contains('title-color-picker-icon')) {
                var entryPane = event.target.closest('.entry-pane');
                if (entryPane && entryPane.dataset.entryId) {
                    var entryIndex = parseInt(entryPane.dataset.entryId);
                    var entry = entries[entryIndex];
                    showColorPicker(entryPane, entry, false);
                }
            } else if (event.target.classList.contains('bg-color-picker-icon')) {
                var entryPane = event.target.closest('.entry-pane');
                if (entryPane && entryPane.dataset.entryId) {
                    var entryIndex = parseInt(entryPane.dataset.entryId);
                    var entry = entries[entryIndex];
                    showColorPicker(entryPane, entry, true);
                }
            }
        });

        entryList.addEventListener('dragstart', function(event) {
            if (event.target.classList.contains('entry-item')) {
                var entryIndex = event.target.getAttribute('data-index');
                event.dataTransfer.setData("entry-index", entryIndex);
            }
        });

        entryContent.addEventListener('drop', function(event) {
            event.preventDefault();
            var entryIndex = event.dataTransfer.getData("entry-index");
            if (entryIndex !== null) {
                var entryToSplit = entries[parseInt(entryIndex)];
                splitPane(entryContent, entryToSplit);
            }
        });

        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = '';
        });

        entryContent.addEventListener('keydown', function(e) {
            if (e.ctrlKey && (e.key === "ArrowUp" || e.key === "ArrowDown")) {
                var selection = window.getSelection();
                if (selection.rangeCount === 0) return;
                var range = selection.getRangeAt(0);
                var currentNode = range.startContainer;
                var currentElement = currentNode.nodeType === Node.ELEMENT_NODE ? currentNode : currentNode.parentElement;
                var isCheckboxLine = currentElement.nodeName === "INPUT" || (currentElement.nodeName === "DIV" && currentElement.querySelector('input[type="checkbox"]'));
                if (!isCheckboxLine) return;
                var currentDiv = currentElement.nodeName === "INPUT" ? currentElement : currentElement.closest('div');
                var siblingDiv = e.key === "ArrowUp" ? currentDiv.previousElementSibling : currentDiv.nextElementSibling;
                if (siblingDiv && (siblingDiv.querySelector('input[type="checkbox"]') || siblingDiv.nodeName === "INPUT")) {
                    e.preventDefault();
                    var movedDiv = moveCheckboxLine(currentDiv, siblingDiv, e.key);
                    setCursorToEnd(movedDiv);
                }
            }
            if (e.key === 'Enter') {
                var selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    var range = selection.getRangeAt(0);
                    var container = range.startContainer;
                    var parentDiv = container.nodeType === 3 ? container.parentNode : container;
                    var isCheckboxStart = parentDiv.textContent.trim().startsWith('[ ]');
                    var containsCheckboxInput = parentDiv.querySelector('input[type="checkbox"]') !== null;
                    var newLine;
                    if (isCheckboxStart || containsCheckboxInput) {
                        e.preventDefault();
                        newLine = isCheckboxStart ? createTextCheckboxLine() : createCheckboxLine();
                        if (parentDiv.isSameNode(entryContent.querySelector('.content-editable')) && entryContent.querySelector('.content-editable').childNodes.length === 1) {
                            entryContent.querySelector('.content-editable').appendChild(newLine);
                        } else {
                            parentDiv.after(newLine);
                        }
                        moveCursorToEnd(newLine);
                    }
                }
            }
            if (e.key === 'Tab') {
                e.preventDefault();
                document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (entryContentStorage.value.trim().length > 0) {
                    loadEntries();
                } else {
                    entries = []; 
                    var newEntry = addNewEntry("Notes"); 
                    current = newEntry.id;
                    updateEntryList();
                    clearAndLoadEntry(newEntry);
                }
            }, 250);
            addDragAndDropVisuals();
            var contentEditableDiv = document.querySelector("[contenteditable='true']");
            if (contentEditableDiv) {
                contentEditableDiv.addEventListener('input', ensureDivWrapper);
                ensureDivWrapper();
            }
        });
        
        

    </script>
</body>
</html>
